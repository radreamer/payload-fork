{"version":3,"sources":["../../../../../src/queues/operations/runJobs/runJob/importHandlerPath.ts"],"sourcesContent":["// @ts-strict-ignore\nimport { pathToFileURL } from 'url'\n\nexport async function importHandlerPath<T>(path: string): Promise<T> {\n  let runner: T\n  const [runnerPath, runnerImportName] = path.split('#')\n\n  let runnerModule\n  try {\n    // We need to check for `require` for compatibility with outdated frameworks that do not\n    // properly support ESM, like Jest. This is not done to support projects without \"type\": \"module\" set\n    runnerModule =\n      typeof require === 'function'\n        ? await eval(`require('${runnerPath.replaceAll('\\\\', '/')}')`)\n        : await eval(`import('${pathToFileURL(runnerPath).href}')`)\n  } catch (e) {\n    throw new Error(\n      `Error importing job queue handler module for path ${path}. This is an advanced feature that may require a sophisticated build pipeline, especially when using it in production or within Next.js, e.g. by calling opening the /api/payload-jobs/run endpoint. You will have to transpile the handler files separately and ensure they are available in the same location when the job is run. If you're using an endpoint to execute your jobs, it's recommended to define your handlers as functions directly in your Payload Config, or use import paths handlers outside of Next.js. Import Error: \\n${e.message}`,\n    )\n  }\n\n  // If the path has indicated an #exportName, try to get it\n  if (runnerImportName && runnerModule[runnerImportName]) {\n    runner = runnerModule[runnerImportName]\n  }\n\n  // If there is a default export, use it\n  if (!runner && runnerModule.default) {\n    runner = runnerModule.default\n  }\n\n  // Finally, use whatever was imported\n  if (!runner) {\n    runner = runnerModule\n  }\n\n  return runner\n}\n"],"names":["pathToFileURL","importHandlerPath","path","runner","runnerPath","runnerImportName","split","runnerModule","require","eval","replaceAll","href","e","Error","message","default"],"mappings":"AAAA,oBAAoB;AACpB,SAASA,aAAa,QAAQ,MAAK;AAEnC,OAAO,eAAeC,kBAAqBC,IAAY;IACrD,IAAIC;IACJ,MAAM,CAACC,YAAYC,iBAAiB,GAAGH,KAAKI,KAAK,CAAC;IAElD,IAAIC;IACJ,IAAI;QACF,wFAAwF;QACxF,qGAAqG;QACrGA,eACE,OAAOC,YAAY,aACf,MAAMC,KAAK,CAAC,SAAS,EAAEL,WAAWM,UAAU,CAAC,MAAM,KAAK,EAAE,CAAC,IAC3D,MAAMD,KAAK,CAAC,QAAQ,EAAET,cAAcI,YAAYO,IAAI,CAAC,EAAE,CAAC;IAChE,EAAE,OAAOC,GAAG;QACV,MAAM,IAAIC,MACR,CAAC,kDAAkD,EAAEX,KAAK,+gBAA+gB,EAAEU,EAAEE,OAAO,EAAE;IAE1lB;IAEA,0DAA0D;IAC1D,IAAIT,oBAAoBE,YAAY,CAACF,iBAAiB,EAAE;QACtDF,SAASI,YAAY,CAACF,iBAAiB;IACzC;IAEA,uCAAuC;IACvC,IAAI,CAACF,UAAUI,aAAaQ,OAAO,EAAE;QACnCZ,SAASI,aAAaQ,OAAO;IAC/B;IAEA,qCAAqC;IACrC,IAAI,CAACZ,QAAQ;QACXA,SAASI;IACX;IAEA,OAAOJ;AACT"}