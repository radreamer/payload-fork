{"version":3,"sources":["../../src/auth/executeAuthStrategies.ts"],"sourcesContent":["import type { AuthStrategyFunctionArgs, AuthStrategyResult } from './index.js'\n\nimport { logError } from '../utilities/logError.js'\nimport { mergeHeaders } from '../utilities/mergeHeaders.js'\nexport const executeAuthStrategies = async (\n  args: AuthStrategyFunctionArgs,\n): Promise<AuthStrategyResult> => {\n  let result: AuthStrategyResult = { user: null }\n\n  if (!args.payload.authStrategies?.length) {\n    return result\n  }\n\n  for (const strategy of args.payload.authStrategies) {\n    // add the configured AuthStrategy `name` to the strategy function args\n    args.strategyName = strategy.name\n\n    try {\n      const authResult = await strategy.authenticate(args)\n      if (authResult.responseHeaders) {\n        authResult.responseHeaders = mergeHeaders(\n          result.responseHeaders || new Headers(),\n          authResult.responseHeaders || new Headers(),\n        )\n      }\n      result = authResult\n    } catch (err) {\n      logError({ err, payload: args.payload })\n    }\n\n    if (result.user) {\n      return result\n    }\n  }\n  return result\n}\n"],"names":["logError","mergeHeaders","executeAuthStrategies","args","result","user","payload","authStrategies","length","strategy","strategyName","name","authResult","authenticate","responseHeaders","Headers","err"],"mappings":"AAEA,SAASA,QAAQ,QAAQ,2BAA0B;AACnD,SAASC,YAAY,QAAQ,+BAA8B;AAC3D,OAAO,MAAMC,wBAAwB,OACnCC;IAEA,IAAIC,SAA6B;QAAEC,MAAM;IAAK;IAE9C,IAAI,CAACF,KAAKG,OAAO,CAACC,cAAc,EAAEC,QAAQ;QACxC,OAAOJ;IACT;IAEA,KAAK,MAAMK,YAAYN,KAAKG,OAAO,CAACC,cAAc,CAAE;QAClD,uEAAuE;QACvEJ,KAAKO,YAAY,GAAGD,SAASE,IAAI;QAEjC,IAAI;YACF,MAAMC,aAAa,MAAMH,SAASI,YAAY,CAACV;YAC/C,IAAIS,WAAWE,eAAe,EAAE;gBAC9BF,WAAWE,eAAe,GAAGb,aAC3BG,OAAOU,eAAe,IAAI,IAAIC,WAC9BH,WAAWE,eAAe,IAAI,IAAIC;YAEtC;YACAX,SAASQ;QACX,EAAE,OAAOI,KAAK;YACZhB,SAAS;gBAAEgB;gBAAKV,SAASH,KAAKG,OAAO;YAAC;QACxC;QAEA,IAAIF,OAAOC,IAAI,EAAE;YACf,OAAOD;QACT;IACF;IACA,OAAOA;AACT,EAAC"}