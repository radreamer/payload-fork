{"version":3,"sources":["../../../src/auth/endpoints/logout.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { generateExpiredPayloadCookie } from '../cookies.js'\nimport { logoutOperation } from '../operations/logout.js'\n\nexport const logoutHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n  const { t } = req\n  const result = await logoutOperation({\n    collection,\n    req,\n  })\n\n  const headers = headersWithCors({\n    headers: new Headers(),\n    req,\n  })\n\n  if (!result) {\n    return Response.json(\n      {\n        message: t('error:logoutFailed'),\n      },\n      {\n        headers,\n        status: httpStatus.BAD_REQUEST,\n      },\n    )\n  }\n\n  const expiredCookie = generateExpiredPayloadCookie({\n    collectionAuthConfig: collection.config.auth,\n    config: req.payload.config,\n    cookiePrefix: req.payload.config.cookiePrefix,\n  })\n\n  headers.set('Set-Cookie', expiredCookie)\n\n  return Response.json(\n    {\n      message: t('authentication:logoutSuccessful'),\n    },\n    {\n      headers,\n      status: httpStatus.OK,\n    },\n  )\n}\n"],"names":["status","httpStatus","getRequestCollection","headersWithCors","generateExpiredPayloadCookie","logoutOperation","logoutHandler","req","collection","t","result","headers","Headers","Response","json","message","BAD_REQUEST","expiredCookie","collectionAuthConfig","config","auth","payload","cookiePrefix","set","OK"],"mappings":"AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,4BAA4B,QAAQ,gBAAe;AAC5D,SAASC,eAAe,QAAQ,0BAAyB;AAEzD,OAAO,MAAMC,gBAAgC,OAAOC;IAClD,MAAMC,aAAaN,qBAAqBK;IACxC,MAAM,EAAEE,CAAC,EAAE,GAAGF;IACd,MAAMG,SAAS,MAAML,gBAAgB;QACnCG;QACAD;IACF;IAEA,MAAMI,UAAUR,gBAAgB;QAC9BQ,SAAS,IAAIC;QACbL;IACF;IAEA,IAAI,CAACG,QAAQ;QACX,OAAOG,SAASC,IAAI,CAClB;YACEC,SAASN,EAAE;QACb,GACA;YACEE;YACAX,QAAQC,WAAWe,WAAW;QAChC;IAEJ;IAEA,MAAMC,gBAAgBb,6BAA6B;QACjDc,sBAAsBV,WAAWW,MAAM,CAACC,IAAI;QAC5CD,QAAQZ,IAAIc,OAAO,CAACF,MAAM;QAC1BG,cAAcf,IAAIc,OAAO,CAACF,MAAM,CAACG,YAAY;IAC/C;IAEAX,QAAQY,GAAG,CAAC,cAAcN;IAE1B,OAAOJ,SAASC,IAAI,CAClB;QACEC,SAASN,EAAE;IACb,GACA;QACEE;QACAX,QAAQC,WAAWuB,EAAE;IACvB;AAEJ,EAAC"}