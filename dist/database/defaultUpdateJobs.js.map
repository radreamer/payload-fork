{"version":3,"sources":["../../src/database/defaultUpdateJobs.ts"],"sourcesContent":["import type { BaseJob, DatabaseAdapter } from '../index.js'\nimport type { UpdateJobs } from './types.js'\n\nimport { jobsCollectionSlug } from '../queues/config/index.js'\n\nexport const defaultUpdateJobs: UpdateJobs = async function updateMany(\n  this: DatabaseAdapter,\n  { id, data, limit, req, returning, where },\n) {\n  const updatedJobs: BaseJob[] | null = []\n\n  const jobsToUpdate: BaseJob[] = (\n    id\n      ? [\n          await this.findOne({\n            collection: jobsCollectionSlug,\n            req,\n            where: { id: { equals: id } },\n          }),\n        ]\n      : (\n          await this.find({\n            collection: jobsCollectionSlug,\n            limit,\n            pagination: false,\n            req,\n            where,\n          })\n        ).docs\n  ).filter(Boolean) as BaseJob[]\n\n  if (!jobsToUpdate) {\n    return null\n  }\n\n  for (const job of jobsToUpdate) {\n    const updateData = {\n      ...job,\n      ...data,\n    }\n    const updatedJob = await this.updateOne({\n      id: job.id,\n      collection: jobsCollectionSlug,\n      data: updateData,\n      req,\n      returning,\n    })\n    updatedJobs.push(updatedJob)\n  }\n\n  return updatedJobs\n}\n"],"names":["jobsCollectionSlug","defaultUpdateJobs","updateMany","id","data","limit","req","returning","where","updatedJobs","jobsToUpdate","findOne","collection","equals","find","pagination","docs","filter","Boolean","job","updateData","updatedJob","updateOne","push"],"mappings":"AAGA,SAASA,kBAAkB,QAAQ,4BAA2B;AAE9D,OAAO,MAAMC,oBAAgC,eAAeC,WAE1D,EAAEC,EAAE,EAAEC,IAAI,EAAEC,KAAK,EAAEC,GAAG,EAAEC,SAAS,EAAEC,KAAK,EAAE;IAE1C,MAAMC,cAAgC,EAAE;IAExC,MAAMC,eAA0B,AAC9BP,CAAAA,KACI;QACE,MAAM,IAAI,CAACQ,OAAO,CAAC;YACjBC,YAAYZ;YACZM;YACAE,OAAO;gBAAEL,IAAI;oBAAEU,QAAQV;gBAAG;YAAE;QAC9B;KACD,GACD,AACE,CAAA,MAAM,IAAI,CAACW,IAAI,CAAC;QACdF,YAAYZ;QACZK;QACAU,YAAY;QACZT;QACAE;IACF,EAAC,EACDQ,IAAI,AAAD,EACTC,MAAM,CAACC;IAET,IAAI,CAACR,cAAc;QACjB,OAAO;IACT;IAEA,KAAK,MAAMS,OAAOT,aAAc;QAC9B,MAAMU,aAAa;YACjB,GAAGD,GAAG;YACN,GAAGf,IAAI;QACT;QACA,MAAMiB,aAAa,MAAM,IAAI,CAACC,SAAS,CAAC;YACtCnB,IAAIgB,IAAIhB,EAAE;YACVS,YAAYZ;YACZI,MAAMgB;YACNd;YACAC;QACF;QACAE,YAAYc,IAAI,CAACF;IACnB;IAEA,OAAOZ;AACT,EAAC"}